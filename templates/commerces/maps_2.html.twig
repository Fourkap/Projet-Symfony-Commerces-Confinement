<!DOCTYPE html>
<html>
<script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link href="{{ asset('css/heroic-features.css') }}" rel="stylesheet" media="all">
<link href="{{asset('css/maps.css')}}" rel="stylesheet" media="all">
<script src="{{asset('js/markerclusterer.js')}}" type="text/javascript"></script>

</head>

<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container">
        <a class="navbar-brand" href="#">Commerces</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarResponsive" >
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link" href='{{ path("listeCommerces") }}'>Liste
                        <span class="sr-only">(current)</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{{ path('maps')}}">Maps</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Services</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Contact</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class='container'>

    <div class="jumbotron mt-5">
        <h3>Filtrer</h3>
<div class="  row pb-5">

            <div class="col card">
                <h4>Arrondisements</h4>
                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75001">
                    <label class="form-check-label" for="flexCheckDefault">
                        75001
                    </label>

                </div>



                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75002">
                    <label class="form-check-label" for="flexCheckDefault">
                        75002
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75003">
                    <label class="form-check-label" for="flexCheckDefault">
                        75003
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75004">
                    <label class="form-check-label" for="flexCheckDefault">
                        75004
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75005">
                    <label class="form-check-label" for="flexCheckDefault">
                        75005
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75006">
                    <label class="form-check-label" for="flexCheckDefault">
                        75006
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75007">
                    <label class="form-check-label" for="flexCheckDefault">
                        75007
                    </label>
                </div>


                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75008">
                    <label class="form-check-label" for="flexCheckDefault">
                        75008
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75009">
                    <label class="form-check-label" for="flexCheckDefault">
                        75009
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75010">
                    <label class="form-check-label" for="flexCheckDefault">
                        75010
                    </label>
                </div>


                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75011">
                    <label class="form-check-label" for="flexCheckDefault">
                        75011
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75012">
                    <label class="form-check-label" for="flexCheckDefault">
                        75012
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75013">
                    <label class="form-check-label" for="flexCheckDefault">
                        75013
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75014">
                    <label class="form-check-label" for="flexCheckDefault">
                        75014
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75015">
                    <label class="form-check-label" for="flexCheckDefault">
                        75015
                    </label>
                </div>


                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75016">
                    <label class="form-check-label" for="flexCheckDefault">
                        75016
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75017">
                    <label class="form-check-label" for="flexCheckDefault">
                        75017
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75018">
                    <label class="form-check-label" for="flexCheckDefault">
                        75018
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75019">
                    <label class="form-check-label" for="flexCheckDefault">
                        75019
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input cp" type="checkbox" value="75020">
                    <label class="form-check-label" for="flexCheckDefault">
                        75020
                    </label>
                </div>











            </div>



            <div class="col card">
                <h4>Type de commerces</h4>
                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Restaurant ou traiteur">
                    <label class="form-check-label" for="flexCheckDefault">
                        Restaurant ou traiteur
                    </label>
                </div>


                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Autre">
                    <label class="form-check-label" for="flexCheckDefault">
                       Autre
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Artisanat d'art">
                    <label class="form-check-label" for="flexCheckDefault">
                        Artisanat d'art
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Bricolage">
                    <label class="form-check-label" for="flexCheckDefault">
                        Bricolage
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Chocolaterie - Patisserie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Chocolaterie - Patisserie
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Fleuriste">
                    <label class="form-check-label" for="flexCheckDefault">
                        Fleuriste
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Fromagerie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Fromagerie
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Équipements informatiques">
                    <label class="form-check-label" for="flexCheckDefault">
                        Équipements informatiques
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Caviste - Brasserie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Caviste - Brasserie
                    </label>
                </div>


                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Librairie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Librairie
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Épicerie fine">
                    <label class="form-check-label" for="flexCheckDefault">
                        Épicerie fine
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Alimentation générale et produits de première nécessité">
                    <label class="form-check-label" for="flexCheckDefault">
                        Alimentation générale et produits de première nécessité
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Pharmacies et parapharmacies">
                    <label class="form-check-label" for="flexCheckDefault">
                        Pharmacies et parapharmacies
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Articles médicaux et orthopédiques">
                    <label class="form-check-label" for="flexCheckDefault">
                        Articles médicaux et orthopédiques
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Poissonnerie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Poissonnerie
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Primeur">
                    <label class="form-check-label" for="flexCheckDefault">
                        Primeur
                    </label>
                </div>

                <div class="form-check">
                    <input class="form-check-input type" type="checkbox" value="Boucherie - charcuterie - rôtisserie">
                    <label class="form-check-label" for="flexCheckDefault">
                        Boucherie - charcuterie - rôtisserie
                    </label>
                </div>


























            </div>

    <div class="col card">
        <h4>Services</h4>
    <div class="form-check">
        <input class="form-check-input service" type="checkbox" value="Retrait de commandes en magasin">
        <label class="form-check-label" for="flexCheckDefault">
            Retrait de commandes en magasin
        </label>
    </div>

        <div class="form-check">
            <input class="form-check-input service" type="checkbox" value="Livraisons à domicile">
            <label class="form-check-label" for="flexCheckDefault">
                Livraisons à domicile
            </label>
        </div>

        <div class="form-check">
            <input class="form-check-input service" type="checkbox" value="Livraisons à domicile, Retrait de commandes en magasin">
            <label class="form-check-label" for="flexCheckDefault">
                Livraisons à domicile, Retrait de commandes en magasin
            </label>
        </div>


    </div>


</div>
    <div class="row">
        <div class="col-md-12 text-center">
            <div>
                <button id="test">Filtrer</button>
            </div>
        </div>

    </div>
</div>




    <div class="row text-center  pb-5">
        <div id="streetView" >
            <h5>Veuillez cliquez sur un marker pour afficher la streetView</h5>
        </div>


        <div id="map" class="col-md-8" ></div>
    </div>

    <div class="row text-center">
        {% for list in listeCommercesAll %}


            <!-- Page Features -->

            <div class="col-sm-4 col-md-4 pb-5" >
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title">{{ list.getNomDuCommerce() }}</h3>
                        <p class="card-text" >
                            Adresse: {{ list.getCodePostal() }}, {{ list.getAdresse() }}<hr>
                        Services: {{ list.getServices() }}<hr>
                        Types de commerces: {{ list.getTypeDeCommerce() }}
                        </p>
                    </div>
                    <div class="card-footer">
                        <a href='{{ path("listOneCommerces", {id: list.id })}}' class="btn btn-primary" >Détails</a>
                    </div>
                </div>
            </div>



        {% endfor %}

    </div>
    {{ knp_pagination_render(listeCommercesAll) }}
</div>
<!-- Footer -->
<footer class="py-5 bg-dark mt-5t-5">
    <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Your Website 2020</p>
    </div>
    <!-- /.container -->
</footer>
</body>
</html>







<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js" integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0" crossorigin="anonymous"></script>
<script src="https://maps.google.com/maps/api/js?key=AIzaSyDhz5F_8JR7OnMj_JnsiyQQxk0xo89RiOo" type="text/javascript"></script>

<!-- Carte -->

<script async type="text/javascript">
    // On initialise la latitude et la longitude de Paris (centre de la carte)
    var lat = 48.852969;
    var lon = 2.349903
    var map = null;
    // Fonction d'initialisation de la carte
    function initMap() {
        // Créer l'objet "map" et l'insèrer dans l'élément HTML qui a l'ID "map"
        map = new google.maps.Map(document.getElementById("map"), {
            // Nous plaçons le centre de la carte avec les coordonnées ci-dessus
            center: new google.maps.LatLng(lat, lon),
            // Nous définissons le zoom par défaut
            zoom: 12,
            // Nous définissons le type de carte (ici carte routière)
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            // Nous activons les options de contrôle de la carte (plan, satellite...)
            mapTypeControl: true,
            // Nous désactivons la roulette de souris
            scrollwheel: false,
            mapTypeControlOptions: {
                // Cette option sert à définir comment les options se placent
                style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR
            },
            // Activation des options de navigation dans la carte (zoom...)
            navigationControl: true,
            navigationControlOptions: {
                // Comment ces options doivent-elles s'afficher
                style: google.maps.NavigationControlStyle.ZOOM_PAN
            }
        });



        //function appellée pour afficher la viewstreet à partir de coordonnées
        function streetView(myPointStreet){
            var panorama = new google.maps.StreetViewPanorama(
                document.getElementById('streetView'), {
                    position: myPointStreet,
                    pov: {
                        heading: 34,
                        pitch: 10
                    }
                });
            map.setStreetView(panorama);
        }


        var markers = [];


        // Déclaration de la infoWindow
        var infoWindow = new google.maps.InfoWindow();
        // boucle sur la liste reçue du controller listeFranceConvert()
        // boucle sur le tableau reçu du controller listeFranceConvert()
        {% for tab in tableau %}
        // Déclaration des coordonnées
        newPoint1 = new google.maps.LatLng({{ tab.2}}, {{ tab.1}});
        console.log(newPoint1);
        // Déclaration des paramètres récupérer du tableau
        var commerce = "{{ tab.0.getNomDuCommerce }}";
        var cp = "{{ tab.0.getCodePostal }}";
        var adresse = "{{ tab.0.getAdresse }}";
        var service = "{{ tab.0.getServices }}";
        {#var description = "{{ tab.0.getDescription }}";#}
        var typeCo = "{{ tab.0.getTypeDeCommerce }}";
        var num = "{{ tab.0.id }}";
        //alert(commerce);
        // Création d'un marker
        var marker = new google.maps.Marker({
            position: newPoint1,
            title: commerce,
            map: map
        });
        // enregistrement dans le tableau des markers
        markers.push(marker);

        // InfoWindow
        (function (marker, commerce,  adresse, num,cp,service,typeCo, pointrecu) {
            google.maps.event.addListener(marker, "click", function (e) {
                //Contenu de l'infoWindow
                infoWindow.setContent(
                    "<div class='card-body'>"
                    +"<h3 class='card-title'>"+commerce+"</h3>"
                    +"<p class='card-text'>"
                    +"Adresse: "+cp+", "+adresse
                    +"<hr>"
                    +"Services: "+service
                    +"<hr>"
                    +"Types de commerces: "+typeCo
                    +"</div>"
                    +"<div class='card-footer'>"
                    +"<a href='{{ path("listOneCommerces", {id: tab.0.id })}}' class='btn btn-primary' >Détails</a>"
                    +"</div>"
                );

                streetView(pointrecu);


                //ouveture de l'infoWindow avec paramètres : le nom de la carte et le marker
                infoWindow.open(map, marker);
            });
            //Variables déclarées plus haut mis en paramètre
        }) (marker, commerce,  adresse , num,cp,service,typeCo, newPoint1)
        // Fin de la boucle For
        {%  endfor %}


        var markerCluster = new MarkerClusterer(map, markers, {
            imagePath:
                "https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m"
        });
    }
    window.onload = function(){
        // Fonction d'initialisation qui s'exécute lorsque le DOM est chargé
        initMap();
    };
</script>


<script>
    $(document).ready(function(){
        alert("jquery ok");
        $("#test").button().click(function(){
            var selectedCountry = new Array();
            var n = jQuery(".cp:checked").length;
            if (n > 0){
                jQuery(".cp:checked").each(function(){
                    selectedCountry.push($(this).val());
                });
            }
            alert(selectedCountry);

            var resto = new Array();
            var n = jQuery(".type:checked").length;
            if (n > 0){
                jQuery(".type:checked").each(function(){
                    resto.push($(this).val());
                });
            }

            var service = new Array();
            var n = jQuery(".service:checked").length;
            if (n > 0){
                jQuery(".service:checked").each(function(){
                    service.push($(this).val());
                });
            }



            var url = '{{ path("tri", {'codepostal': 'selectedCountry','type': 'resto','services': 'test'}) }}';
            url = url.replace("amp;", "");url = url.replace("amp;", "");

            url = url.replace("selectedCountry", selectedCountry);
            url = url.replace("resto", resto);
            url = url.replace("test", service);
            alert(url);
            window.location.replace(url);
        });

    });

       //  // it is checked
       // var cp1 =  $("input[type='checkbox']").val();
       // console.log(cp1);





</script>